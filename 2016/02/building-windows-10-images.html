<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/assets/512.png" />
    <title>Adam Laycock :: Building Windows 10 Images</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/font-awesome/css/all.min.css" />
    <meta property="og:title" content="Adam Laycock / Building Windows 10 Images" />
    <meta
      property="og:description"
      content="Keeping up with the Windows releases."
    />
    <meta property="og:image" content="https://alaycock.co.uk/assets/og-image.png" />
  </head>
  <body>
    <div class="grid grid-cols-1 lg:grid-cols-layout gap-4">
      <div
        class="bg-white border-gray-200 border shadow-xl p-2 mt-4 mx-4 lg:col-start-2 lg:mx-0 text-center lg:text-left"
      >
        <img
          src="/assets/profile.jpg"
          alt="Adam Laycock"
          class="lg:m-auto w-32 float-left lg:float-none lg:w-full mr-4"
        />
        <h2 class="font-light text-2xl">Adam Laycock</h2>
        <h3 class="font-light text-lg">EdTech Network Manager & Developer</h3>

        <div class="grid grid-cols-3 gap-2 text-center mt-4">
          <a
            href="/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >Home</a
          >
          <a
            href="/blog/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >Posts</a
          >
          <a
            href="/talks/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >Talks</a
          >
          <a
            href="/about/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >About</a
          >
          <a
            href="/cv/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >CV</a
          >
          <a
            href="/uses/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >Uses</a
          >
          <a
            href="/contact/"
            class="bg-gray-200 p-2 shadow border border-gray-300 hover:shadow-none"
            >Contact</a
          >
        </div>
      </div>
      <div class="lg:row-span-2">
        <section class="p-4 lg:pb-0 lg:pl-0"><div class="bg-white border-gray-300 border shadow-xl p-2 mb-4">
  <h1 class="font-light text-3xl border-b border-gray-200 mb-4">Building Windows 10 Images</h1>
  <ul class="flex gap-2">
    <li>01 February 2016</li>
    
      <li><a href="/tag/windows10">#windows10</a></li>
    
  </ul>
</div>
<div class="bg-white prose border-gray-300 border shadow-xl p-2"><p>Windows 10 is fantastic and naturally lots of my Schools are chomping at the bit to get it deployed to their devices.</p>

<p>This has lead to a couple of problematic image builds over the past couple of months due to sysprep being unable to complete <strong>after</strong> the store has been setup for a user. It seems that if you want to sysprep an image you can’t use the store <strong>or</strong> let Windows 10 do a big update e.g. 1511.</p>

<p>Our existing method for build images was pretty close to working there are just a few gotchas that needed to be corrected before first login.</p>

<p>We had to start from scratch. No updating the existing 7 or 8.1 image it had to be a fresh install, and an up to date 10 version as well we couldn’t install the 1511 update ourselves it has to be pre-installed. This means getting an <em>install.wim</em> from the latest edition of Windows 10 we wanted to use which for us was <em>Windows 10 Education 1511</em>. We then added that to our WDS server as a deployable image. Personally I prefer having the clean disk images on WDS just as a backup but they can be removed after creating the base image.</p>

<p>Next we needed to get around the stores first run which since we wanted the sore gone anyway we decided to do with the domain. This meant getting a GPO to turn the store off and getting the image to join the domain straight from imaging.</p>

<p>An unattended join of the domain is nothing new, I use it in all my schools and there are plenty of guides on how to do it on the internet already like <a href="http://sharepointgeorge.com/2009/windows-deployment-services-waik-and-windows-7-part1/">this one</a> so I wont go into detail here.</p>

<p>I spent quite a while trying to get <a href="https://technet.microsoft.com/en-gb/library/hh824929.aspx">Windows SIM</a> to generate my catalog file, with 7 the .clg was on the disk but for some reason Microsoft no longer provide them so we had to generate it. It appears the SIM can’t generate a catalog unless you are on the same OS as the catalog is for. Reading into the issues to begin with confused me as it only mention processor architecture not OS version, once I tried on a machine running Education 1511 is went through straight away.</p>

<p>Now that we had the <em>base image</em> ready to deploy and join the domain by itself we needed to make the domain turn off the store. We grabbed the ADMX templates from <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48257">here</a> and dropped them into the central store on our Domain. We added a new GPO that applied to all our users and added the following config:</p>

<p><code class="language-plaintext highlighter-rouge">User Configuration -&gt; Policies -&gt; Administrative Templates -&gt; Windows Components -&gt; Store</code></p>

<p>enable <code class="language-plaintext highlighter-rouge">Turn off the Store Application</code></p>

<p>After getting that GPO setup the base image deployed no problem, joined the domain and sat on the login screen. First login by an administrator <em>did not</em> cause the store to initialize which in turn meant that we could sysprep that image.</p>

<h2 id="future-issues">Future Issues</h2>

<p>Having updates like 1511 cause sysprep to break is going to be a right pain. We will either have to let big updates through WSUS and hope that all clients install them successfully or build the image again on the new updated version.</p>

<p>Not great.</p>

<p>I hope that Microsoft do something about this issues before the Redstone update otherwise they are drastically increasing our workload if we want to stay up to date.</p>
</div></section>
        <footer class="mt-4 px-4 lg:px-0">
          &copy; Adam Laycock 2025
        </footer>
      </div>
    </div>
  </body>
</html>
